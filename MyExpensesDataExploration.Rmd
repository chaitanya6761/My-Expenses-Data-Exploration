---
title: "My Expenses Data Exploration"
output:
  html_document: default
  html_notebook: default
---
## 1. Loading The Datadet And Required Imports
```{r message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
setwd("E:/MOOC")
expenses <- read.csv("walnut.csv",stringsAsFactors=FALSE)
```

## 2. Dimensions Of The Dataset
```{r}
dim(expenses)
```

## 3. Description of the variables and thier types.
```{r}
str(expenses)
```

## 4. Data Cleaning 
As part of data cleaning, lets remove some unnecessary columns and transform some variables like date and amount from chr variables to date and number variables. The Account variable contains some sensitive information like last 4 digits of my debit and credit cards, so I am removing that variable from the dataframe.  

Apart from removing some columns, I have added columns like year and month to track yearwise and monthwise expenses.
```{r}
expenses <- subset(expenses,select = -c(NOTE,TIME,ACCOUNT,TAGS))
expenses$DATE <- as.Date(expenses$DATE,format='%d-%m-%y')
expenses$MONTH <- as.factor(format(expenses$DATE,'%b'))
expenses$YEAR<- as.factor(format(expenses$DATE,'%Y'))
expenses$PLACE <- as.factor(expenses$PLACE)
expenses$EXPENSE <- as.factor(expenses$EXPENSE)
expenses$CATEGORY <- ifelse(expenses$CATEGORY == "","UNKNOWN",expenses$CATEGORY)
expenses$CATEGORY <- as.factor(expenses$CATEGORY)
expenses$AMOUNT <- as.numeric(gsub(",","",expenses$AMOUNT))
str(expenses)
```

## 5. Expense Variable And Total Expenses:
The expense varaiable has mainly two values, YES and NO, if the values is YES, the record can be counted as expense.
```{r}
summary(expenses$EXPENSE)
```
Now Lets transform our expenses dataset so that it includes only those records, that can be counted as expenses.
```{r}
expenses <- subset(expenses,expenses$EXPENSE == "Yes")
```
  
#### The Total Amount Of Money Spend Till Date:
```{r}
sum(expenses$AMOUNT)
```
#### The Total Amount Spent By Year:
```{r}
with(expenses,by(AMOUNT,YEAR,sum))
```
```{r}
expenses_by_year <- expenses %>% 
  group_by(YEAR) %>%
  summarize(total=sum(AMOUNT),n=n())

ggplot(data=expenses_by_year,aes(x=YEAR,y=total))+
  geom_bar(stat="identity",color="black", width=0.3,fill="#F4511E")+
  geom_text(aes(label=total), vjust=-1.2) +
  scale_y_continuous(breaks = seq(0,400000,50000),limits =c(0,400000))+
  labs(y="AMOUNT SPENT",x="DIFFERENT YEARS",title="YEAR V/S SPENDS")+
  theme(axis.text=element_text(size=10),axis.title=element_text(size=14,face="bold"))+
  theme(plot.title = element_text(hjust = 0.5,size = 14,face = "bold"))
```

From here on, I will be considering the expenses of the 2017 only, as they are better categorized then the expenses of 2015 and 2016. 

## 6. Category Varaiable :
The category variable captures the diiferent type of categories I spend in.
```{r}
levels(expenses$CATEGORY)
```
Now lets calculate category wise spends:
```{r warning=FALSE}
expenses <- subset(expenses,YEAR == "2017")
expenses_by_category <- expenses %>% 
  group_by(CATEGORY)%>%
  summarize(total=sum(AMOUNT),n = n())%>%
  arrange(desc(total))

expenses_by_category
```

```{r}
ggplot(data=arrange(expenses_by_category,total),aes(x=CATEGORY,y=total))+
  geom_bar(stat="identity",color="black",fill="#F4511E")+
  geom_text(aes(label=total), hjust=-0.2) +
  coord_flip()+
  scale_y_continuous(breaks = seq(0,101000,25000),limits = c(0,109000))+
  labs(y="AMOUNT SPENT",x="DIFFERENT CATEGORIES",title="CATEGORIES V/S SPENDS")+
  theme(axis.text=element_text(size=10),axis.title=element_text(size=14,face="bold"))+
  theme(plot.title = element_text(hjust = 0.5,size = 14,face = "bold"))
```

## 7. Month Varaible:
In this section I will be exploring my month wise expenses.
```{r}
expenses$MONTH <- factor(expenses$MONTH,ordered = TRUE, levels = c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
expenses_by_month <- expenses %>% 
  group_by(MONTH) %>%
  summarize(total = sum(AMOUNT),n=n())

expenses_by_month
```

```{r}
ggplot(data=expenses_by_month,aes(x=MONTH,y=total))+
  geom_bar(stat="identity",color="black",fill="#F4511E")+
  geom_text(aes(label=total), vjust=-1.4) +
  labs(y="AMOUNT SPENT",x="DIFFERENT MONTHS",title="SPENDS V/S MONTH")+
  scale_y_continuous(breaks = seq(0,65000,10000),limits = c(0,62000))+
  geom_hline(yintercept = 20000,linetype=2,size=0.9,color="black")+
  theme(axis.text=element_text(size=12),axis.title=element_text(size=14,face="bold"))+
  theme(plot.title = element_text(hjust = 0.5,size = 14,face = "bold"))
```

```{r}
expenses_by_month_category <- expenses %>% 
  group_by(MONTH,CATEGORY) %>%
  summarize(total = sum(AMOUNT),
            n= n())


expenses_by_month_category
```

```{r message=FALSE, warning=FALSE}
ggplot(data=expenses_by_month_category,aes(x=MONTH,y=total,fill=CATEGORY))+
  geom_bar(stat = "identity",color="black",position = "stack")+
  scale_fill_manual(values = c("#98FB98","#4B0082","grey","pink","green",
                               "yellow","red","yellow","#6A5ACD","#00BFFF","#FF00FF","darkblue","darkred"))+
  theme_classic()
```






